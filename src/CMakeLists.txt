# set the sources from which to compile the target library

set(r3d_SOURCES
  r2d.c
  r3d.c
  rNd.c
  v2d.c
  v3d.c
  vNd.c)

target_sources(r3d PRIVATE ${r3d_SOURCES})

# What headers should it use and install

set(r3d_HEADERS
  r2d.h
  r3d.h
  rNd.h
  v2d.h
  v3d.h
  vNd.h
  )

list(TRANSFORM r3d_HEADERS PREPEND "${CMAKE_CURRENT_SOURCE_DIR}/")

set_target_properties(r3d PROPERTIES
  PUBLIC_HEADER "${r3d_HEADERS}")

# In addition to the include directories of the source, we need to
# include the build or directory to get the autogenerated r3d-config.h
# (The first of these is needed if R3D is included as a submodule, the
# second is needed for the auto-generated config file if R3D is
# included as a submodule, the third is to get the autogenerated
# config header if R3D is being compiled separately (not sure this has
# been input correctly or in the best manner) and the last is for
# dependencies in installations)

target_include_directories(r3d PUBLIC
  $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}>
  $<BUILD_INTERFACE:${r3d_BINARY_DIR}>
  $<BUILD_INTERFACE:${CMAKE_BINARY_DIR}>
  $<INSTALL_INTERFACE:include>)


set(ENABLE_UNIT_TESTS False CACHE BOOL "build and run tests")

if (ENABLE_UNIT_TESTS)

  # r2d unit tests
  add_executable(r2d_unit_tests tests/test_helpers.c tests/utest.c tests/r2d_unit_tests.c)
  target_link_libraries(r2d_unit_tests PRIVATE r3d m)
  add_test(NAME r2d_unit_tests
    COMMAND r2d_unit_tests
    WORKING_DIRECTORY ${PROJECT_BINARY_DIR})
  
  # r3d unit tests
  add_executable(r3d_unit_tests tests/test_helpers.c tests/utest.c tests/r3d_unit_tests.c)
  target_link_libraries(r3d_unit_tests PRIVATE r3d m)
  add_test(NAME r3d_unit_tests
    COMMAND r3d_unit_tests
    WORKING_DIRECTORY ${PROJECT_BINARY_DIR})

  # rNd unit tests
  add_executable(rNd_unit_tests tests/test_helpers.c tests/utest.c tests/rNd_unit_tests.c)
  target_link_libraries(rNd_unit_tests PRIVATE r3d m)
  add_test(NAME rNd_unit_tests
    COMMAND rNd_unit_tests
    WORKING_DIRECTORY ${PROJECT_BINARY_DIR})

  
  # brep tests
  add_executable(brep_unit_tests test_brep/test_intersection.cc)
  target_link_libraries(brep_unit_tests PRIVATE r3d m)
  add_test(NAME brep_unit_tests
    COMMAND brep_unit_tests
    WORKING_DIRECTORY ${PROJECT_BINARY_DIR})

  
endif ()
